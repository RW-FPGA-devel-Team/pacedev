#include <stdio.h>
#include <stdlib.h>
#include <ctype.h>

#include "osd_types.h"

uint16_t dvg_x;
uint16_t dvg_y;
int8_t dvg_scale;
uint16_t dvg_brightness;

#define SCALE(s) (1<<(9-(dvg_scale+s)))

uint8_t dvgrom[] =
{
	0x80, 0xA0,	0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x90,	0xFF, 0x73, 0xFF, 0x92, 0x00, 0x70,
	0x00, 0x90,	0xFF, 0x77, 0xFF, 0x96, 0x00, 0x70, 0xFF, 0x92,	0xFF, 0x72, 0x00, 0x86, 0x00, 0x72,
	0xFE, 0x87,	0xFE, 0x77, 0x00, 0x92, 0x00, 0x76, 0xFE, 0x81,	0x00, 0x72, 0xFF, 0x96, 0xFF, 0x72,
	0x7F, 0xA3,	0xFF, 0x03, 0x00, 0x70, 0x00, 0x00, 0xFF, 0x96,	0xFF, 0x76, 0xFE, 0x81, 0x00, 0x76,
	0x00, 0x92,	0x00, 0x72, 0xFE, 0x87, 0xFE, 0x73, 0x00, 0x86,	0x00, 0x76, 0xFF, 0x92, 0xFF, 0x76,
	0xFC, 0xA1,	0xF4, 0x01, 0x00, 0x70, 0x00, 0x00, 0xDB, 0xF0,	0x00, 0xF9, 0xCF, 0xF0, 0x00, 0xF9,
	0xBB, 0xF0,	0x00, 0xF9, 0xAF, 0xF0, 0x00, 0xF9, 0x9B, 0xF0,	0x00, 0xF9, 0x8F, 0xF0, 0x00, 0xF9,
	0x7B, 0xF0,	0x00, 0xF9, 0x6F, 0xF0, 0x00, 0xF9, 0x5B, 0xF0,	0x00, 0xF9, 0x4F, 0xF0, 0x00, 0xF9,
	0x3B, 0xF0,	0x00, 0xF9, 0x2F, 0xF0, 0x7C, 0xD0, 0xE4, 0xA0,	0x5E, 0x11, 0x00, 0x70, 0x00, 0x00,
	0x80, 0xCA,	0x78, 0xCA, 0xD8, 0xCA, 0xC7, 0xCA, 0x2C, 0xCB,	0x9B, 0xCA, 0xF3, 0xCA, 0xF3, 0xCA,
	0xDD, 0xCA,	0xF3, 0xEA, 0x80, 0xA0, 0x90, 0x01, 0x00, 0x70,	0x00, 0x00, 0x73, 0xF5, 0x73, 0xF1,
	0x78, 0xF1,	0x77, 0xF1, 0x77, 0xF5, 0x78, 0xF5, 0x80, 0x31,	0x00, 0x02, 0x75, 0xF8, 0x70, 0xFD,
	0x71, 0xF8,	0x02, 0xFD, 0x2E, 0xCB, 0x63, 0xCB, 0x56, 0xCB,	0x63, 0xCB, 0x2C, 0xCB, 0x78, 0xCA,
	0x02, 0xCB,	0x78, 0xCA, 0xF3, 0xCA, 0xBA, 0xCA, 0x2C, 0xCB,	0xBA, 0xCA, 0xD8, 0xCA, 0x8D, 0xEA,
	0xC6, 0xFF,	0xC1, 0xFE, 0xC3, 0xF1, 0xCD, 0xF1, 0xC7, 0xF1,	0xC1, 0xFD, 0xD8, 0x1E, 0x32, 0xEC,
	0x00, 0xC4,	0x3C, 0x14, 0x0A, 0x46, 0xD8, 0xD8, 0xD0, 0xC8,	0xB5, 0xC8, 0x96, 0xC8, 0x80, 0xC8,
	0x0D, 0xF8,	0x78, 0xF8, 0x0D, 0xFD, 0x78, 0xF8, 0x09, 0xFD,	0x78, 0xF8, 0x0B, 0xF1, 0x78, 0xF8,
	0x0A, 0xF5,	0x78, 0xF8, 0x08, 0xF9, 0x78, 0xF8, 0x09, 0xF3,	0x78, 0xF8, 0x0D, 0xF3, 0x78, 0xF8,
	0x80, 0x54,	0x00, 0x06, 0x78, 0xF8, 0x0F, 0xF1, 0x78, 0xF8,	0x00, 0xD0, 0x00, 0x30, 0x80, 0x07,
	0x78, 0xF8,	0x80, 0x37, 0x80, 0x07, 0x78, 0xF8, 0x80, 0x37,	0x80, 0x03, 0x78, 0xF8, 0xE0, 0x40,
	0xA0, 0x02,	0x78, 0xF8, 0xC0, 0x35, 0x80, 0x03, 0x78, 0xF8,	0x80, 0x33, 0x00, 0x00, 0x78, 0xF8,
	0xA0, 0x42,	0xE0, 0x00, 0x78, 0xF8, 0xA0, 0x42, 0xE0, 0x04,	0x78, 0xF8, 0xE0, 0x44, 0x80, 0x07,
	0x78, 0xF8,	0xE0, 0x40, 0xA0, 0x06, 0x78, 0xF8, 0x00, 0xD0,	0x07, 0xF8, 0x78, 0xF8, 0x07, 0xFF,
	0x78, 0xF8,	0x03, 0xFF, 0x78, 0xF8, 0xC0, 0x40, 0x40, 0x02,	0x78, 0xF8, 0x80, 0x35, 0x00, 0x03,
	0x78, 0xF8,	0x00, 0xFB, 0x78, 0xF8, 0x40, 0x42, 0xC0, 0x00,	0x78, 0xF8, 0x40, 0x42, 0xC0, 0x04,
	0x78, 0xF8,	0xC0, 0x44, 0x00, 0x07, 0x78, 0xF8, 0xC0, 0x40,	0x40, 0x06, 0x78, 0xF8, 0x00, 0xD0,
	0x00, 0x30,	0x80, 0x06, 0x78, 0xF8, 0x80, 0x36, 0x80, 0x06,	0x78, 0xF8, 0x80, 0x36, 0x80, 0x02,
	0x78, 0xF8,	0x40, 0x31, 0xC0, 0x03, 0x78, 0xF8, 0x40, 0x35,	0x80, 0x02, 0x78, 0xF8, 0x80, 0x32,
	0x00, 0x00,	0x78, 0xF8, 0xC0, 0x33, 0x40, 0x01, 0x78, 0xF8,	0xC0, 0x33, 0x40, 0x05, 0x78, 0xF8,
	0xA0, 0x44,	0x80, 0x06, 0x78, 0xF8, 0x40, 0x31, 0xC0, 0x07,	0x78, 0xF8, 0x00, 0xD0, 0xF3, 0xC8,
	0xFF, 0xC8,	0x0D, 0xC9, 0x1A, 0xC9, 0x08, 0xF9, 0x79, 0xF9,	0x79, 0xFD, 0x7D, 0xF6, 0x79, 0xF6,
	0x8F, 0xF6,	0x8F, 0xF0, 0x7D, 0xF9, 0x78, 0xFA, 0x79, 0xF9,	0x79, 0xFD, 0x00, 0xD0, 0x0A, 0xF1,
	0x7A, 0xF1,	0x7D, 0xF9, 0x7E, 0xF5, 0x7E, 0xF1, 0x7D, 0xFD,	0x79, 0xF6, 0x7D, 0xF6, 0x79, 0xFD,
	0x79, 0xF1,	0x8B, 0xF5, 0x8A, 0xF3, 0x7D, 0xF9, 0x00, 0xD0,	0x0D, 0xF8, 0x7E, 0xF5, 0x7A, 0xF7,
	0x7A, 0xF3,	0x78, 0xF7, 0x79, 0xF8, 0x7A, 0xF3, 0x78, 0xF9,	0x7E, 0xF3, 0x7F, 0xF0, 0x7F, 0xF7,
	0x7A, 0xF5,	0x00, 0xD0, 0x09, 0xF0, 0x7B, 0xF1, 0x68, 0xF1,	0x7F, 0xF2, 0x7F, 0xF0, 0x69, 0xF6,
	0x7F, 0xF0,	0x78, 0xF7, 0x7A, 0xF7, 0x7B, 0xF1, 0x69, 0xF5,	0x69, 0xF9, 0x7F, 0xF2, 0x00, 0xD0,
	0x29, 0xC9,	0x0E, 0xF1, 0xCA, 0xF8, 0x0B, 0xF6, 0x00, 0x60,	0x80, 0xD6, 0xDB, 0xF6, 0xCA, 0xF8,
	0xDB, 0xF2,	0xDF, 0xF2, 0xCD, 0xF2, 0xCD, 0xF8, 0xCD, 0xF6,	0xDF, 0xF6, 0x00, 0xD0, 0x90, 0x52,
	0xA8, 0x52,	0xCC, 0x52, 0xF0, 0x52, 0x14, 0x53, 0x36, 0x53,	0x5A, 0x53, 0x7E, 0x53, 0xA2, 0x53,
	0xC6, 0x53,	0xEA, 0x53, 0x0E, 0x54, 0x32, 0x54, 0x56, 0x54,	0x7A, 0x54, 0x9E, 0x54, 0xC2, 0x54,
	0x0F, 0xF6,	0xC8, 0xFA, 0xBD, 0xF9, 0x00, 0x65, 0x00, 0xC3,	0x00, 0x65, 0x00, 0xC7, 0xB9, 0xF9,
	0x00, 0xD0,	0xCE, 0xF9, 0xCA, 0xF9, 0x00, 0xD0, 0x40, 0x46,	0xC0, 0x06, 0x00, 0x52, 0x30, 0xC4,
	0xC0, 0x41,	0x20, 0xC6, 0xB0, 0x64, 0x18, 0xC3, 0x48, 0x65,	0xE0, 0xC6, 0x20, 0x42, 0xC0, 0xC1,
	0x00, 0xD0,	0xD0, 0x50, 0x10, 0xC6, 0x60, 0x42, 0xC0, 0xC3,	0x00, 0xD0, 0x80, 0x46, 0x80, 0x06,
	0xE0, 0x43,	0xC0, 0xC4, 0xA0, 0x41, 0x60, 0xC6, 0x68, 0x64,	0x20, 0xC3, 0x90, 0x65, 0xC0, 0xC6,
	0x60, 0x42,	0xA0, 0xC1, 0x00, 0xD0, 0x90, 0x50, 0x30, 0xC6,	0xC0, 0x42, 0x80, 0xC3, 0x00, 0xD0,
	0xC0, 0x46,	0x40, 0x06, 0xE0, 0x43, 0x20, 0xC5, 0x60, 0x41,	0x80, 0xC6, 0x18, 0x64, 0x28, 0xC3,
	0xD0, 0x65,	0x98, 0xC6, 0x80, 0x42, 0x60, 0xC1, 0x00, 0xD0,	0x60, 0x50, 0x30, 0xC6, 0x20, 0x43,
	0x40, 0xC3,	0x00, 0xD0, 0x0E, 0xF7, 0xC0, 0x43, 0x80, 0xC5,	0x20, 0x41, 0xA0, 0xC6, 0x38, 0x60,
	0x28, 0xC3,	0x10, 0x66, 0x60, 0xC6, 0xA0, 0x42, 0x20, 0xC1,	0x00, 0xD0, 0x30, 0x50, 0x40, 0xC6,
	0x60, 0x43,	0xE0, 0xC2, 0x00, 0xD0, 0x20, 0x47, 0xC0, 0x05,	0x80, 0x43, 0xE0, 0xC5, 0xE0, 0x40,
	0xC0, 0xC6,	0x88, 0x60, 0x20, 0xC3, 0x48, 0x66, 0x30, 0xC6,	0xC0, 0x42, 0xE0, 0xC0, 0x00, 0xD0,
	0x10, 0x54,	0x40, 0xC6, 0xA0, 0x43, 0xA0, 0xC2, 0x00, 0xD0,	0x60, 0x47, 0x60, 0x05, 0x60, 0x43,
	0x40, 0xC6,	0x80, 0x40, 0xC0, 0xC6, 0xD8, 0x60, 0x10, 0xC3,	0x80, 0x66, 0xF0, 0xC5, 0xC0, 0x42,
	0x80, 0xC0,	0x00, 0xD0, 0x40, 0x54, 0x30, 0xC6, 0xE0, 0x43,	0x40, 0xC2, 0x00, 0xD0, 0x80, 0x47,
	0x00, 0x05,	0x20, 0x43, 0x80, 0xC6, 0x40, 0x40, 0xE0, 0xC6,	0x20, 0x61, 0xF8, 0xC2, 0xB0, 0x66,
	0xB0, 0xC5,	0xE0, 0x42, 0x40, 0xC0, 0x00, 0xD0, 0x80, 0x54,	0x30, 0xC6, 0x10, 0x52, 0xF0, 0xC0,
	0x00, 0xD0,	0x80, 0x47, 0xC0, 0x04, 0xE0, 0x42, 0xE0, 0xC6,	0x00, 0x40, 0xE0, 0xC6, 0x68, 0x61,
	0xD8, 0xC2,	0xD8, 0x66, 0x68, 0xC5, 0xE0, 0x42, 0x00, 0xC0,	0x00, 0xD0, 0xB0, 0x54, 0x20, 0xC6,
	0x20, 0x52,	0xB0, 0xC0, 0x00, 0xD0, 0xA0, 0x47, 0x60, 0x04,	0x80, 0x42, 0x20, 0xC7, 0x40, 0x44,
	0xE0, 0xC6,	0xB0, 0x61, 0xB0, 0xC2, 0xF8, 0x66, 0x20, 0xC5,	0xE0, 0x42, 0x40, 0xC4, 0x00, 0xD0,
	0xF0, 0x54,	0x10, 0xC6, 0x30, 0x52, 0x80, 0xC0, 0x00, 0xD0,	0xA0, 0x47, 0x00, 0x00, 0x40, 0x42,
	0x60, 0xC7,	0x80, 0x44, 0xC0, 0xC6, 0xF0, 0x61, 0x80, 0xC2,	0x10, 0x67, 0xD8, 0xC4, 0xC0, 0x42,
	0x80, 0xC4,	0x00, 0xD0, 0x40, 0x46, 0xE0, 0xC7, 0x30, 0x52,	0x40, 0xC0, 0x00, 0xD0, 0xA0, 0x47,
	0x60, 0x00,	0xE0, 0x41, 0x80, 0xC7, 0xE0, 0x44, 0xC0, 0xC6,	0x30, 0x62, 0x48, 0xC2, 0x20, 0x67,
	0x88, 0xC4,	0xC0, 0x42, 0xE0, 0xC4, 0x00, 0xD0, 0xA0, 0x46,	0xA0, 0xC7, 0x40, 0x52, 0x10, 0xC0,
	0x00, 0xD0,	0x80, 0x47, 0xC0, 0x00, 0x80, 0x41, 0xC0, 0xC7,	0x20, 0x45, 0xA0, 0xC6, 0x60, 0x62,
	0x10, 0xC2,	0x28, 0x67, 0x38, 0xC4, 0xA0, 0x42, 0x20, 0xC5,	0x00, 0xD0, 0xE0, 0x46, 0x60, 0xC7,
	0x40, 0x52,	0x30, 0xC4, 0x00, 0xD0, 0x80, 0x47, 0x00, 0x01,	0x20, 0x41, 0xE0, 0xC7, 0x60, 0x45,
	0x80, 0xC6,	0x98, 0x62, 0xD0, 0xC1, 0x28, 0x67, 0x18, 0xC0,	0x80, 0x42, 0x60, 0xC5, 0x00, 0xD0,
	0x40, 0x47,	0x20, 0xC7, 0x30, 0x52, 0x60, 0xC4, 0x00, 0xD0,	0x60, 0x47, 0x60, 0x01, 0xC0, 0x40,
	0xE0, 0xC7,	0xA0, 0x45, 0x60, 0xC6, 0xC0, 0x62, 0x90, 0xC1,	0x20, 0x67, 0x68, 0xC0, 0x60, 0x42,
	0xA0, 0xC5,	0x00, 0xD0, 0x80, 0x47, 0xC0, 0xC6, 0x30, 0x52,	0x90, 0xC4, 0x00, 0xD0, 0x20, 0x47,
	0xC0, 0x01,	0x30, 0x50, 0x00, 0xC6, 0xC0, 0x45, 0x20, 0xC6,	0xE0, 0x62, 0x48, 0xC1, 0x18, 0x67,
	0xB0, 0xC0,	0x20, 0x42, 0xC0, 0xC5, 0x00, 0xD0, 0xC0, 0x47,	0x60, 0xC6, 0x10, 0x52, 0xD0, 0xC4,
	0x00, 0xD0,	0x0A, 0xF7, 0xCE, 0xF8, 0xCD, 0xFD, 0x00, 0x63,	0x00, 0xC1, 0x00, 0x67, 0x00, 0xC1,
	0xCD, 0xF9,	0x00, 0xD0, 0xCD, 0xFE, 0xCD, 0xFA, 0x00, 0xD0,	0x0E, 0xF7, 0x7A, 0xF8, 0x79, 0xFD,
	0x00, 0x63,	0x00, 0x75, 0x00, 0x67, 0x00, 0x75, 0x79, 0xF9,	0xC0, 0x60, 0x80, 0x02, 0x9F, 0xD0,
	0x70, 0xFA,	0x72, 0xF2, 0x72, 0xF6, 0x70, 0xFE, 0x06, 0xF9,	0x72, 0xF8, 0x02, 0xF6, 0x00, 0xD0,
	0x70, 0xFB,	0x73, 0xF0, 0x71, 0xF5, 0x70, 0xF5, 0x75, 0xF5,	0x77, 0xF0, 0x03, 0xF0, 0x71, 0xF5,
	0x70, 0xF5,	0x75, 0xF5, 0x77, 0xF0, 0x03, 0xF8, 0x00, 0xD0,	0x70, 0xFB, 0x72, 0xF8, 0x06, 0xFF,
	0x72, 0xF8,	0x02, 0xF0, 0x00, 0xD0, 0x70, 0xFB, 0x72, 0xF0,	0x72, 0xF6, 0x70, 0xF6, 0x76, 0xF6,
	0x76, 0xF0,	0x03, 0xF8, 0x00, 0xD0, 0x70, 0xFB, 0x72, 0xF8,	0x05, 0xF7, 0x77, 0xF0, 0x00, 0xF7,
	0x72, 0xF8,	0x02, 0xF0, 0x00, 0xD0, 0x70, 0xFB, 0x72, 0xF8,	0x05, 0xF7, 0x77, 0xF0, 0x00, 0xF7,
	0x03, 0xF8,	0x00, 0xD0, 0x70, 0xFB, 0x72, 0xF8, 0x70, 0xF6,	0x06, 0xF6, 0x72, 0xF0, 0x70, 0xF6,
	0x76, 0xF8,	0x03, 0xF8, 0x00, 0xD0, 0x70, 0xFB, 0x00, 0xF7,	0x72, 0xF8, 0x00, 0xF3, 0x70, 0xFF,
	0x02, 0xF0,	0x00, 0xD0, 0x72, 0xF8, 0x06, 0xF0, 0x70, 0xFB,	0x02, 0xF0, 0x76, 0xF8, 0x03, 0xFF,
	0x00, 0xD0,	0x00, 0xF2, 0x72, 0xF6, 0x72, 0xF0, 0x70, 0xFB,	0x01, 0xFF, 0x00, 0xD0, 0x70, 0xFB,
	0x03, 0xF0,	0x77, 0xF7, 0x73, 0xF7, 0x03, 0xF0, 0x00, 0xD0,	0x00, 0xFB, 0x70, 0xFF, 0x72, 0xF8,
	0x02, 0xF0,	0x00, 0xD0, 0x70, 0xFB, 0x72, 0xF6, 0x72, 0xF2,	0x70, 0xFF, 0x02, 0xF0, 0x00, 0xD0,
	0x70, 0xFB,	0x72, 0xFF, 0x70, 0xFB, 0x01, 0xFF, 0x00, 0xD0,	0x70, 0xFB, 0x72, 0xF8, 0x70, 0xFF,
	0x76, 0xF8,	0x03, 0xF8, 0x00, 0xD0, 0x70, 0xFB, 0x72, 0xF8,	0x70, 0xF7, 0x76, 0xF8, 0x03, 0xF7,
	0x03, 0xF0,	0x00, 0xD0, 0x70, 0xFB, 0x72, 0xF8, 0x70, 0xFE,	0x76, 0xF6, 0x76, 0xF0, 0x02, 0xF2,
	0x72, 0xF6,	0x02, 0xF0, 0x00, 0xD0, 0x70, 0xFB, 0x72, 0xF8,	0x70, 0xF7, 0x76, 0xF8, 0x01, 0xF0,
	0x73, 0xF7,	0x02, 0xF0, 0x00, 0xD0, 0x72, 0xF8, 0x70, 0xF3,	0x76, 0xF8, 0x70, 0xF3, 0x72, 0xF8,
	0x01, 0xFF,	0x00, 0xD0, 0x02, 0xF0, 0x70, 0xFB, 0x06, 0xF0,	0x72, 0xF8, 0x01, 0xFF, 0x00, 0xD0,
	0x00, 0xFB,	0x70, 0xFF, 0x72, 0xF8, 0x70, 0xFB, 0x01, 0xFF,	0x00, 0xD0, 0x00, 0xFB, 0x71, 0xFF,
	0x71, 0xFB,	0x01, 0xFF, 0x00, 0xD0, 0x00, 0xFB, 0x70, 0xFF,	0x72, 0xF2, 0x72, 0xF6, 0x70, 0xFB,
	0x01, 0xFF,	0x00, 0xD0, 0x72, 0xFB, 0x06, 0xF8, 0x72, 0xFF,	0x02, 0xF0, 0x00, 0xD0, 0x02, 0xF0,
	0x70, 0xFA,	0x76, 0xF2, 0x02, 0xF8, 0x76, 0xF6, 0x02, 0xFE,	0x00, 0xD0, 0x00, 0xFB, 0x72, 0xF8,
	0x76, 0xFF,	0x72, 0xF8, 0x02, 0xF0, 0x00, 0xD0, 0x03, 0xF8,	0x00, 0xD0, 0x02, 0xF0, 0x70, 0xFB,
	0x02, 0xFF,	0x00, 0xD0, 0x00, 0xFB, 0x72, 0xF8, 0x70, 0xF7,	0x76, 0xF8, 0x70, 0xF7, 0x72, 0xF8,
	0x02, 0xF0,	0x00, 0xD0, 0x72, 0xF8, 0x70, 0xFB, 0x76, 0xF8,	0x00, 0xF7, 0x72, 0xF8, 0x02, 0xF7,
	0x00, 0xD0,	0x00, 0xFB, 0x70, 0xF7, 0x72, 0xF8, 0x00, 0xF3,	0x70, 0xFF, 0x02, 0xF0, 0x00, 0xD0,
	0x72, 0xF8,	0x70, 0xF3, 0x76, 0xF8, 0x70, 0xF3, 0x72, 0xF8,	0x01, 0xFF, 0x00, 0xD0, 0x00, 0xF3,
	0x72, 0xF8,	0x70, 0xF7, 0x76, 0xF8, 0x70, 0xFB, 0x03, 0xFF,	0x00, 0xD0, 0x00, 0xFB, 0x72, 0xF8,
	0x70, 0xFF,	0x02, 0xF0, 0x00, 0xD0, 0x72, 0xF8, 0x70, 0xFB,	0x76, 0xF8, 0x70, 0xFF, 0x00, 0xF3,
	0x72, 0xF8,	0x02, 0xF7, 0x00, 0xD0, 0x02, 0xF8, 0x70, 0xFB,	0x76, 0xF8, 0x70, 0xF7, 0x72, 0xF8,
	0x02, 0xF7,	0x00, 0xD0, 0x2C, 0xCB, 0xDD, 0xCA, 0x2E, 0xCB,	0x32, 0xCB, 0x3A, 0xCB, 0x41, 0xCB,
	0x48, 0xCB,	0x4F, 0xCB, 0x56, 0xCB, 0x5B, 0xCB, 0x63, 0xCB,	0x78, 0xCA, 0x80, 0xCA, 0x8D, 0xCA,
	0x93, 0xCA,	0x9B, 0xCA, 0xA3, 0xCA, 0xAA, 0xCA, 0xB3, 0xCA,	0xBA, 0xCA, 0xC1, 0xCA, 0xC7, 0xCA,
	0xCD, 0xCA,	0xD2, 0xCA, 0xD8, 0xCA, 0xDD, 0xCA, 0xE3, 0xCA,	0xEA, 0xCA, 0xF3, 0xCA, 0xFB, 0xCA,
	0x02, 0xCB,	0x08, 0xCB, 0x0E, 0xCB, 0x13, 0xCB, 0x1A, 0xCB,	0x1F, 0xCB, 0x26, 0xCB, 0x0B, 0x13,
	0x19, 0x2F,	0x41, 0x55, 0x6F, 0x77, 0x7D, 0x87, 0x91, 0x63,	0x56, 0x60, 0x6E, 0x3C, 0xEC, 0x4D,
	0xC0, 0xA4,	0x0A, 0xEA, 0x6C, 0x08, 0x00, 0xEC, 0xF2, 0xB0,	0x6E, 0x3C, 0xEC, 0x48, 0x5A, 0xB8,
	0x66, 0x92,	0x42, 0x9A, 0x82, 0xC3, 0x12, 0x0E, 0x12, 0x90,	0x4C, 0x4D, 0xF1, 0xA4, 0x12, 0x2D,
	0xD2, 0x0A,	0x64, 0xC2, 0x6C, 0x0F, 0x66, 0xCD, 0x82, 0x6C,	0x9A, 0xC3, 0x4A, 0x85, 0xC0, 0xA6,
	0x6E, 0x60,	0x6C, 0x9E, 0x0A, 0xC2, 0x42, 0xC4, 0xC2, 0xBA,	0x60, 0x49, 0xF0, 0x0C, 0x12, 0xC6,
	0x12, 0xB0,	0x00, 0xA6, 0x6E, 0x60, 0x58, 0xED, 0x12, 0xB5,	0xE8, 0x29, 0xD2, 0x0E, 0xD8, 0x4C,
	0x82, 0x82,	0x70, 0xC2, 0x6C, 0x0B, 0x6E, 0x09, 0xE6, 0xB5,	0x92, 0x3E, 0x00, 0xA6, 0x6E, 0x60,
	0x6E, 0xC1,	0x6C, 0xC0, 0x00, 0x59, 0x62, 0x48, 0x66, 0xD2,	0x6D, 0x18, 0x4E, 0x9B, 0x64, 0x09,
	0x02, 0xA4,	0x0A, 0xED, 0xC0, 0x18, 0x4E, 0x9B, 0x64, 0x08,	0xC2, 0xA4, 0x0A, 0xE8, 0x00, 0x20,
	0x4E, 0x9B,	0x64, 0xB8, 0x46, 0x0D, 0x20, 0x2F, 0x40, 0x00,	0x03, 0x06, 0x09, 0x0C, 0x10, 0x13,
	0x16, 0x19,	0x1C, 0x1F, 0x22, 0x25, 0x28, 0x2B, 0x2E, 0x31,	0x33, 0x36, 0x39, 0x3C, 0x3F, 0x41,
	0x44, 0x47,	0x49, 0x4C, 0x4E, 0x51, 0x53, 0x55, 0x58, 0x5A,	0x5C, 0x5E, 0x60, 0x62, 0x64, 0x66,
	0x68, 0x6A,	0x6B, 0x6D, 0x6F, 0x70, 0x71, 0x73, 0x74, 0x75,	0x76, 0x78, 0x79, 0x7A, 0x7A, 0x7B,
	0x7C, 0x7D,	0x7D, 0x7E, 0x7E, 0x7E, 0x7F, 0x7F, 0x7F, 0x7F,	0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

extern void osd_line (unsigned x1, unsigned y1, unsigned x2, unsigned y2, unsigned brightness);

void dvgrom_disassemble_jsr (uint16_t addr)
{
	uint8_t *p = &dvgrom[addr-0x5000];
	char buf[1024];
	int done = 0;

	uint16_t stack[8];
	int sp = 0;
	unsigned iterations = 0;
	signed sf;
	unsigned x2, y2;
		
	while (!done)
	{
		uint8_t cmd = *(p+1) >> 4;
		uint16_t offset = (p-dvgrom);
		int16_t x, y;
		uint8_t s;
		uint16_t a;
		uint8_t b;
		char chr;

    switch (cmd)
    {
      // vec
      case 0x00 : case 0x01 : case 0x02 : case 0x03 :
      case 0x04 : case 0x05 : case 0x06 : case 0x07 :
      case 0x08 : case 0x09 :
        //   SSSS -mYY YYYY YYYY | BBBB -mXX XXXX XXXX
        //   YYYY YYYY SSSS -mYY | XXXX XXXX BBBB -mXX 
        x = *(p+2) + (((uint16_t)*(p+3) & 0x03) << 8);
        if (*(p+3) & (1<<2)) x = -x;
        y = *(p+0) + (((uint16_t)*(p+1) & 0x03) << 8);
        if (*(p+1) & (1<<2)) y = -y;
        s = *(p+1) >> 4;
        b = *(p+3) >> 4;
        sprintf (buf, "$%04X: VEC (%02X%02X %02X%02X)", 
                offset, *(p+1), *(p+0), *(p+3), *(p+2));
        printf ("%-32.32s scale=%02d(/%-3d) bri=%d x=%-4d y=%-4d\n", 
        				buf, s, (1<<(9-s)), b, x, y);
        p += 4;
        // update hardware
        sf = SCALE(s);
				osd_line (dvg_x, dvg_y,
									dvg_x + x/sf,
									dvg_y + y/sf,
									b);
				dvg_x += x/sf;
				dvg_y += y/sf;
        break;
      // cur
      case 0x0A :
        // 1010 00yy yyyy yyyy | SSSS 00xx xxxx xxxx
        // yyyy yyyy 1010 00yy | xxxx xxxx SSSS 00xx 
        x = *(p+2) + (((uint16_t)*(p+3) & 0x03) << 8);
        y = *(p+0) + (((uint16_t)*(p+1) & 0x03) << 8);
        s = *(p+3) >> 4;
        sprintf (buf, "$%04X: CUR (%02X%02X %02X%02X)", 
                offset, *(p+1), *(p+0), *(p+3), *(p+2));
        printf ("%-32.32s scale=%02d(/%-3d)       x=%-4d y=%-4d\n", 
        					buf, s, (1<<(9-s)), x, y);
        p += 4;
        // update hardware
        dvg_x = x;
        dvg_y = y;
        dvg_scale = (s > 7 ? s-16 : s);
        break;
      // halt
      case 0x0B :
        sprintf (buf, "$%04X: HALT\n", offset);
        printf ("%-32.32s\n", buf);
        done = 1;
        break;
      // jsr
      case 0x0C :
        // 1100 aaaa aaaa aaaa
        // aaaa aaaa 1100 aaaa 
        a = *(p+0) + (((uint16_t)*(p+1) & 0x0f) << 8);
        sprintf (buf, "$%04X: JSR (%02X%02X)", offset, *(p+1), *(p+0));
        printf ("%-32.32saddr=$%04X '%c'\n", buf, (a<<1)-0x800, chr);
        p += 2;
        stack[sp++] = (p-dvgrom);
        p = &dvgrom[(a<<1)-0x1000];
        break;
      // rts
      case 0x0D :
        sprintf (buf, "$%04X: RTS", offset);
        printf ("%-32.32s\n", buf);
        p += 2;
        if (sp)
      		p = &dvgrom[stack[--sp]];
      	else
	        done = 1;
        break;
      // jmp
      case 0x0E :
        // 1110 aaaa aaaa aaaa
        // aaaa aaaa 1110 aaaa 
        a = *(p+0) + (((uint16_t)*(p+1) & 0x0f) << 8);
        sprintf (buf, "$%04X: JMP (%02X%02X)", offset, *(p+1), *(p+0));
        printf ("%-32.32saddr=$%04X\n", buf, (a<<1)-0x800);
        p = &dvgrom[(a<<1)-0x1000];
        break;
      // svec
      case 0x0F :
      	// 1111 smYY BBBB SmXX
      	// BBBB SmXX 1111 smYY 
      	x = (*(p+0) & 0x03) << 10;		// where does 10 come from?
      	if (*(p+0) & (1<<2)) x = -x;
      	y = (*(p+1) & 0x03) << 10;		// where does 10 come from?
      	if (*(p+1) & (1<<2)) y = -y;
      	s = ((*(p+0) & 0x08) >> 2) | ((*(p+1) & 0x08) >> 3);
      	b = (*(p+0) & 0xf0) >> 4;
        sprintf (buf, "$%04X: SVEC (%02X%02X)", 
        					offset, *(p+1), *(p+0));
        printf ("%-32.32s scale=%02d(/%-3d) bri=%d x=%-4d y=%-4d\n", 
        				buf, s, (1<<(9-s)), b, x, y);
        p += 2;
        // update hardware
        sf = SCALE(s);
        x2 = dvg_x + x/sf;
        y2 = dvg_y + y/sf;
				osd_line (dvg_x, dvg_y, x2, y2, b);
				dvg_x += x/sf;
				dvg_y += y/sf;
        break;
      default :
        break;
    }
    
    if (++iterations == 32)
    	;//break;
	}
}

